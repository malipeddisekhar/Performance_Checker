<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Performance_Checker - Classify Risk</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
  </head>
  <body>
    <div class="container py-4">
      <nav class="navbar glass-card mb-4 p-3">
        <div
          class="container-fluid d-flex justify-content-between align-items-center"
        >
          <div>
            <a
              href="{{ url_for('index') }}"
              class="navbar-brand mb-0 h1 fw-bold text-white"
            >
              <span class="navbar-brand mb-0 h1 fw-bold text-white"
                >Performance_Checker</span
              >
            </a>
            <p class="mb-0 text-light">Student Performance Predictor</p>
          </div>

          <div class="d-flex gap-2">
            <a
              href="{{ url_for('predictor_page') }}"
              class="btn btn-sm fw-semibold text-white"
              style="background-color: #ffae00ff; border: none"
            >
              Predict Score
            </a>

            <a
              href="{{ url_for('index') }}"
              class="btn btn-sm fw-semibold text-white"
              style="background-color: #007bff; border: none"
            >
              ← Back to Home
            </a>
          </div>
        </div>
      </nav>

      <div class="glass-card p-4 mb-4">
        <h2 class="h4 mb-4 text-center">Classify Your Academic Risk</h2>

        <form id="risk-form" class="row g-4">
          <div class="col-md-4">
            <label class="form-label">Attendance <small class="text-muted">(50-100%)</small></label>
            <input
              type="number"
              step="1"
              max="100"
              min="50"
              class="form-control"
              id="attendance"
              placeholder="e.g., 85"
              required
            />
          </div>
          <div class="col-md-4">
            <label class="form-label">CGPA <small class="text-muted">(0-10)</small></label>
            <input
              type="number"
              step="0.1"
              max="10"
              min="0"
              class="form-control"
              id="cgpa"
              placeholder="e.g., 8.5"
              required
            />
          </div>
          <div class="col-md-4">
            <label class="form-label">Certificates <small class="text-muted">(0-10+)</small></label>
            <input
              type="number"
              min="0"
              max="20"
              class="form-control"
              id="certificates"
              placeholder="e.g., 3"
              required
            />
          </div>
          <div class="col-md-4">
            <label class="form-label">Internships <small class="text-muted">(0-5+)</small></label>
            <input
              type="number"
              min="0"
              max="10"
              class="form-control"
              id="internships"
              placeholder="e.g., 2"
              required
            />
          </div>
          <div class="col-md-4">
            <label class="form-label">Extra Curricular <small class="text-muted">(0-10)</small></label>
            <input
              type="number"
              min="0"
              max="10"
              class="form-control"
              id="extra"
              placeholder="e.g., 7"
              required
            />
          </div>
          <div class="col-md-4">
            <label class="form-label">Library Usage <small class="text-muted">(0-60 hrs/month)</small></label>
            <input
              type="number"
              step="1"
              max="60"
              min="0"
              class="form-control"
              id="library"
              placeholder="e.g., 20"
              required
            />
          </div>
          <div class="col-md-4">
            <label class="form-label">Project Involvement <small class="text-muted">(Yes/No)</small></label>
            <select class="form-select" id="project">
              <option value="1">Yes</option>
              <option value="0">No</option>
            </select>
          </div>
          <div class="col-md-4">
            <label class="form-label">GPA Sem 1 <small class="text-muted">(0-10)</small></label>
            <input
              type="number"
              step="0.1"
              max="10"
              min="0"
              class="form-control"
              id="gpa1"
              placeholder="e.g., 8.0"
              required
            />
          </div>
          <div class="col-md-4">
            <label class="form-label">GPA Sem 2 <small class="text-muted">(0-10)</small></label>
            <input
              type="number"
              step="0.1"
              max="10"
              min="0"
              class="form-control"
              id="gpa2"
              placeholder="e.g., 8.2"
              required
            />
          </div>
          <div class="col-12 text-center">
            <button type="submit" class="btn btn-warning px-5 py-2">
              Classify Risk
            </button>
          </div>
        </form>
      </div>

      <div id="risk-result" class="glass-card p-4 d-none text-center">
        <h4 class="mb-3">Your Risk Classification:</h4>
        <h1 id="risk-value" class="display-5 text-danger fw-bold"></h1>
      </div>

      <footer class="glass-card mt-4 p-3 text-center">
        <div class="container">
          <div class="d-flex justify-content-center align-items-center gap-3 flex-wrap mb-2">
            <a href="mailto:malipeddisekhar63@gmail.com" class="text-decoration-none">
              <i class="fas fa-envelope me-1"></i> Email
            </a>
            <span class="text-muted">|</span>
            <a href="https://github.com/malipeddisekhar" target="_blank" class="text-decoration-none">
              <i class="fab fa-github me-1"></i> GitHub
            </a>
            <span class="text-muted">|</span>
            <a href="https://www.linkedin.com/in/malipeddi-sekhar-08650630b/" target="_blank" class="text-decoration-none">
              <i class="fab fa-linkedin me-1"></i> LinkedIn
            </a>
          </div>
          <p class="mb-0 small text-muted">
            © 2026 Malipeddi Sekhar • Performance_Checker
          </p>
        </div>
      </footer>
    </div>

    <script>
      document
        .getElementById("risk-form")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          // Send RAW values - backend will scale them
          const rawInputs = {
            attendance: +document.getElementById("attendance").value,
            cgpa: +document.getElementById("cgpa").value,
            library_usage: +document.getElementById("library").value,
            internships: +document.getElementById("internships").value,
            certificates: +document.getElementById("certificates").value,
            gpa_sem1: +document.getElementById("gpa1").value,
            gpa_sem2: +document.getElementById("gpa2").value,
            project_involvement: +document.getElementById("project").value,
            extra_curricular: +document.getElementById("extra").value,
          };

          try {
            const res = await fetch("/predict_risk", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(rawInputs),
            });

            const data = await res.json();

            if (data.error) {
              alert("Error: " + data.error);
              return;
            }

            const riskBox = document.getElementById("risk-result");
            riskBox.classList.remove("d-none");

            // Determine color based on risk level
            const riskColor = data.risk_level.includes("Excellent") ? "text-success" :
                             data.risk_level.includes("Good") ? "text-info" :
                             data.risk_level.includes("moderate") ? "text-warning" :
                             data.risk_level.includes("Warning") ? "text-orange" : "text-danger";

            riskBox.innerHTML = `
              <h4 class="mb-3">Your Risk Classification:</h4>
              <h3 class="fw-bold ${riskColor}">${data.risk_level}</h3>
              <p class="mt-3">Activity Score: <strong>${data.activity_score}</strong></p>
              <h6 class="mt-4 mb-2">Suggestions to Reduce Risk:</h6>
              <ul class="list-group list-group-flush">
                ${data.suggestions.map((s) => `<li class="list-group-item">${s}</li>`).join("")}
              </ul>
            `;
          } catch (err) {
            alert("Risk prediction failed. Check inputs or server.");
            console.error(err);
          }
        });
    </script>
  </body>
</html>
